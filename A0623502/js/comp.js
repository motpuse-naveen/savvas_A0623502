myView.controller("dndcompCtrl",["$scope","appService","APPCONSTANT","$timeout",function(e,t,a,o){var n={},i={},r={},s={},d=10,c=1,p=!1;e.$on(a.ACTIVITY_LOADED,function(){e.state&&e.state.scaleFix&&e.tabIndex==e.state.tabIndex&&(p=!0,c=$(e.state.scaleFix.parent).height()/$(e.state.scaleFix.content).height(),$.ui.ddmanager.prepareOffsets=function(e,t){var a,o,n=$.ui.ddmanager.droppables[e.options.scope]||[],i=t?t.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(a=0;a<n.length;a++)if(!(n[a].options.disabled||e&&!n[a].accept.call(n[a].element[0],e.currentItem||e.element))){for(o=0;o<r.length;o++)if(r[o]===n[a].element[0]){n[a].proportions().height=0;continue e}n[a].visible="none"!==n[a].element.css("display"),n[a].visible&&("mousedown"===i&&n[a]._activate.call(n[a],t),n[a].offset=n[a].element.offset(),n[a].proportions({width:n[a].element[0].offsetWidth*c,height:n[a].element[0].offsetHeight*c}))}})}),e.fetchComponentData=function(a){e.state=t.getConfigData().data[a]},e.initDnD=function(t){var a={dndcompJson:e.state};e.$emit("DnDInitialized",a)},e.registerDragItems=function(e,t){var a={};a.id=e[0].id,a.pos={},a.pos.left=e[0].getBoundingClientRect().left,a.pos.top=e[0].getBoundingClientRect().top,n[e[0].id]=a},e.registerDropTargets=function(e,t){var a={};a.id=e[0].id,a.pos={},a.pos.left=e[0].getBoundingClientRect().left,a.pos.top=e[0].getBoundingClientRect().top,i[e[0].id]=a},e.onItemDragStart=function(t,a,o){p&&o&&o.containment&&(a.position.left=0,a.position.top=0,r={},r.width=$(o.containment).width(),r.height=$(o.containment).height(),s={},s.width=$(t.target).outerWidth(),s.height=$(t.target).outerHeight()),angular.element(t.target).css("z-index",d++);var n={event:t,ui:a,optionObj:o};e.$emit("ItemDragStarted",n)},e.onItemDrag=function(t,a,o){if(p&&o&&o.containment){var n=c,i=a.position.left-a.originalPosition.left,d=a.originalPosition.left+i/n,l=a.position.top-a.originalPosition.top,m=a.originalPosition.top+l/n;a.position.left=d,a.position.top=m,a.position.left>r.width-s.width&&(d=r.width-s.width,!0),d<0&&(d=0,!0),a.position.top>r.height-s.height&&(m=r.height-s.height,!0),m<0&&(m=0,!0),a.position.left=d,a.position.top=m}var g={event:t,ui:a,optionObj:o};e.$emit("ItemDragging",g)},e.onItemDragStop=function(t,a,o){var n={event:t,ui:a,optionsObj:o};e.$emit("ItemDragStopped",n)},e.onItemDrop=function(t,a,o){var n={event:t,ui:a,optionsObj:o};$(a.draggable).hasClass("droppedItem")?e.$emit("againDropped",n):(e.$emit("ItemDropped",n),$(t.target).find("[draggable-directive]").addClass("droppedItem"))},e.onItemDragOver=function(t,a){var o={event:t,ui:a};e.$emit("ItemDraggedOver",o)},e.onItemDragOut=function(t,a){var o={event:t,ui:a};e.$emit("ItemDraggedOut",o)},e.$on("initDragOnDrop",function(t,a){if(e.state.dragAfterDrop){var o=$(a.event.target).find("[draggable-directive]");a.isResizable&&(o=$(a.event.target).find("[draggable-directive]").parent()),$(a.event.target).find("[draggable-directive]").removeAttr("draggable-directive"),o.draggable(e.state.dragAfterDrop),o.draggable("option",{start:function(t,a){e.onItemDragStart(t,a,e.state.customDragOptionsDropped)},drag:function(t,a){e.onItemDrag(t,a,e.state.customDragOptionsDropped)},stop:function(t,a){e.onItemDragStop(t,a,e.state.customDragOptionsDropped)}})}}),e.$on("initResizeOnDrop",function(t,a){if(e.state.resizeAfterDrop){a.isResizable=!0;var o=$(a.event.target).find("[draggable-directive]");o.resizable(e.state.resizeAfterDrop),o.resizable("option",{start:function(t,a){e.onResizeStart(t,a)},resize:function(t,a){e.onResize(t,a)}})}}),e.onResizeStart=function(e,t){p&&(t.position.left=0,t.position.top=0)},e.onResize=function(e,t){if(p){var a=t.size.width-t.originalSize.width,o=t.originalSize.width+a/percent,n=t.size.height-t.originalSize.height,i=t.originalSize.height+n/percent;t.size.width=o,t.size.height=i}},e.reset=function(){d=10;var t={scope:e};e.$emit("DnDReset",t)},e.$on("resetDnd",function(){e.reset()}),e.$on("toggleDnd",function(e,t){1==t.disable?angular.element(t.elemRef).draggable("option","disabled",!0):angular.element(t.elemRef).draggable("option","disabled",!1)})}]),myView.directive("dndcompDirective",[function(){return{retrict:"A",controller:"dndcompCtrl",link:function(e,t,a){a.id?(e.fetchComponentData(a.id),e.compId=a.id,t.ready(function(){e.initDnD(e.compId)})):console.log("Provide id and json to component")}}}]),myView.directive("draggableDirective",[function(){return{restrict:"A",link:function(e,t,a){t.ready(function(){e.registerDragItems(t,a),t.draggable(e.state.dragOptions);var o="original";o=e.state.dragOptions&&e.state.dragOptions.helper?e.state.dragOptions.helper:e.state.customDragOptions&&e.state.customDragOptions.helper?e.state.customDragOptions.helper:e.state.customDragOptions&&e.state.customDragOptions.containment?function(){return $(this).clone().appendTo(e.state.customDragOptions.containment).css("zIndex",2).show()}:"original",t.draggable("option",{helper:o,start:function(t,a){e.onItemDragStart(t,a,e.state.customDragOptions)},drag:function(t,a){e.onItemDrag(t,a,e.state.customDragOptions)},stop:function(t,a){e.onItemDragStop(t,a,e.state.customDragOptions)}})})}}}]),myView.directive("droppableDirective",[function(){return{restrict:"A",link:function(e,t,a){t.ready(function(){e.registerDropTargets(t,a),t.droppable(e.state.dropOptions),t.droppable("option",{drop:function(t,a){e.onItemDrop(t,a,e.state.customDropOptions)},out:function(t,a){e.onItemDragOut(t,a,e.state.customDropOptions)},over:function(t,a){e.onItemDragOver(t,a,e.state.customDropOptions)}})})}}}]),myView.controller("viewCtrl",["$scope","APPCONSTANT","$interval","appService","$timeout",function(e,t,a,o,n){function i(e){var t,o=1,n=e.x_offset,i=0,r=e.duration,s=e.frames;this.reset=function(){i=0,o=1},this.stop=function(){t&&a.cancel(t)},this.play=function(d,c,p){t&&(this.stop(),this.reset()),d||(d=s),t=a(function(){++o>=d&&(a.cancel(t),c&&c(p)),i-=n,W(e.target).css("background-position-x",i+"px")},r)},this.showLastFrame=function(){t&&a.cancel(t);var o=-1*n*(totalFrames-1);W(e.target).css("background-position-x",o+"px")},this.showThisFrame=function(o){t&&a.cancel(t);var i=-1*n*(o-1);W(e.target).css("background-position-x",i+"px")},this.showFirstFrame=function(){t&&a.cancel(t),W(e.target).css("background-position-x","0px")}}function r(t){e.maxScore=t;var a=0;this.reset=function(){a=0,e.currentScore=0},this.updateScore=function(){L<3&&5==e.displayedReportData.gameType?e.currentScore=a:e.correctAttempted<2&&4==D.gameType?e.currentScore=a:(a++,e.currentScore=a),e.avgPecentage=e.currentScore/e.maxScore*100},this.setScore=function(t){a=t,e.currentScore=t},this.getCurrentScore=function(){return a}}function s(){var e,t=0,a=function(){return Date.now?Date.now():(new Date).getTime()};this.addTimelinePoint=function(){var o=a();return t+=o-e,e=o,t},this.start=function(o){e=a(),o&&(t=o)},this.runningTime=function(){var e=new Date(null);return e.setSeconds(t/1e3),e.toISOString().substr(11,8)}}var d,c,p,l,m,g,u,f,h,y,v,S,D=o.getConfigData().data[o.getConfigData().game_Type].game,I=4==D.gameMode||5==D.gameMode?4:D.displayConfig,w=D.multipleQue,C=o.getConfigData()[o.getConfigData().gameLocale],A=null,b=!1,T=[],R=[],V=[],F=!1,x="",O="",M=[],P=0,G=void 0,B=!1,E=[],L=D.displayConfig;window.myConsole={};var _={splashScreen:".splashScreen",playButtonBox:".playButtonBox",playButton:".playButton",chameleonGreen:".chameleonGreen",chameleonRed:".chameleonRed",optionPicture:".optionPicture",oddRhymeFly:".oddRhymeFly",dropZone:"#phonemicDnd .dropZone",infoIcon:".infoIcon",infoPopup:".infoPopup",resetIcon:".resetIcon",ccIcon:".ccIcon",audioPlayer:"audioPlayer",infoVoIcon:".infoVoIcon",droppedItem:".droppedItem",droppedItemContain:".droppedItemContain",questionImage:".questionImage",endGameAnim:".endGameAnim",upperSection:".upperSection",upperSectionCover:".upperSectionCover",lowerSection:".lowerSection",progressBar:".progressBar",chameleonInteraction:".chameleonInteraction",flySelected:".flySelected",eyeLid:".eyeLid",anchorAnimation:".anchorAnimation",chameleon:".chameleon",chameleonInteraction:".chameleonInteraction",caption:".caption",captionText:".captionText",activeDraggable:".activeDraggable",multiChoices:".multiChoices",audioButton:".audioButton",infoAudioIcon:".infoAudioIcon",endGamePopup:".endGamePopup",gameOverlay:"#gameOverlay"},z={info:D.infoAudios,infoSFX:"assets/audios/infoSFX.mp3",waiting:"assets/audios/waiting.mp3",motivation:"assets/audios/waiting.mp3",rightAction:"assets/audios/correct.mp3",rightAction4:"assets/audios/correct4.mp3",rightAction4Slurp:"assets/audios/correct4Slurp.mp3",wrongAction:"assets/audios/incorrect.mp3",wrongAction4:"assets/audios/incorrect4.mp3",wrongActionVo:"assets/audios/incorrectVo.mp3",gameComplete:"assets/audios/endGame.mp3",gameCompleteVo:"assets/audios/endGameVo.mp3",greatJobVo:"assets/audios/greatJobVo.mp3",fewMoreVo:"assets/audios/fewMoreVo.mp3",itemVo:"",itemVo1:"",end1:"assets/audios/end1.mp3",end2:"assets/audios/end2.mp3",end3:"assets/audios/end3.mp3",end4:"assets/audios/end4.mp3",end5:"assets/audios/end5.mp3",numberVo:"",maxNumberVo:"",eol1:"assets/audios/SJ_EOL1_spa.mp3",eol2:"assets/audios/SJ_EOL2_spa.mp3",eol3:"assets/audios/SJ_EOL3_spa.mp3",eol4:"assets/audios/SJ_EOL4_spa.mp3",notAudio:{en:"assets/audios/info/en/Not.mp3",es:"assets/audios/info/es/No.mp3"}},N={4:[[],[1,1,1,1],[]],5:[[1,0,1,0,1],[0,1,0,1,0],[]],6:[[1,0,1,0,1],[0,1,0,1,0],[0,0,1,0,0]],7:[[1,1,1,1],[1,1,1,0],[]],8:[[1,1,1,1],[1,1,1,1],[]],9:[[1,1,1,1,1],[1,1,1,1,0],[]],10:[[1,1,1,1],[1,1,1,1],[0,1,1,0]],11:[[1,1,1,1,1],[0,1,1,1,1],[0,0,1,1,0]],12:[[1,1,1,1,1,1],[0,1,1,1,1,0],[0,0,1,1,0,0]]},q=[];e.displayedReportData={},e.fullGameReport={},e.gameStartTime="",e.levelEndTime="",e.displayedReportData.startTime="",e.displayedReportData.endTime="",e.displayedReportData.zones=[],e.AccCounter=0,D.gameName=o.getConfigData().game_Type,e.title2=D.gameTitle2[o.getConfigData().gameLocale],e.gameMode=D.gameMode,e.info=D.info[o.getConfigData().gameLocale],e.answerData=D.answerDataV123,e.engineModeV123=4!=D.gameMode&&5!=D.gameMode,e.questionData=e.engineModeV123?D.questionDataV123:D.questionDataV45,e.currentQuestionV45=0,e.showProgressBar=!0,e.showInfo=!1,e.gameCompleted=!1,e.showCaptions=!1,e.startClicked=!1,e.showSplashScreen=!0,e.showDialog=!1,e.openOptionsDialog=!1,e.openReportDialog=!1,e.resetButtonState="Disabled",e.ccButtonState="Disabled",e.avgPecentage=0,e.currentScore=0,e.maxScore=0,e.runningTime=0,e.rightOptionsAttemptedV123=0,e.gameInfo=D.gameInfo[o.getConfigData().gameLocale],e.gameInfoAudio=D.gameInfoAudio[o.getConfigData().gameLocale],e.infoAudio=D.infoAudio[o.getConfigData().gameLocale],e.progressData,e.correctAttempted=0,e.gameType=D.gameType,e.dropSound,e.showReport=!1,e.sortingResponse={0:[],1:[],2:[]},e.displayedReportData.zoneResponses={0:[],1:[],2:[]},e.displayedReportData.gameMode=e.gameMode,e.displayedReportData.questionSet=e.questionData,e.displayedReportData.answerSet=e.answerData,e.displayedReportData.gameName=D.gameName,e.displayedReportData.gameType=D.gameType,e.displayedReportData.chances=D.chances,e.displayedReportData.gameTopic=D.gameTopic[o.getConfigData().gameLocale];for(var Q=0;Q<e.displayedReportData.questionSet.length;Q++){var Z={response:"",isCorrect:!1};e.displayedReportData.zones.push(Z)}e.gameStrings={deafaultLanguage:o.getConfigData().gameLocale,score:C.score,teacherReport:C.teacherReport,downloadReportBtn:C.downloadReportBtn,reportButtonText:C.reportButtonText,informationText:C.informationText,instructionText:C.instructionText,reportTab1:C.reportTab1,reportTab2:C.reportTab2,totalQuestionsAttemptedV123:C.totalQuestionsAttemptedV123,totalQuestionsAttemptedV45:C.totalQuestionsAttemptedV45,correctAnswersGivenV123:C.correctAnswersGivenV123,correctAnswersGivenV45:C.correctAnswersGivenV45,sNo:C.sNo,response:C.response,answerStatus:C.answerStatus,restoreGame:C.restoreGame,startNewGame:C.startNewGame,awesomeText:C.awesomeText,foundText:C.foundText,outOfText:C.outOfText,wordsText:C.wordsText,soundText:C.soundText,mastersText:C.mastersText,tryAgainText:C.tryAgainText,tryAgainBtn:C.tryAgainBtn,playAgainText:C.playAgainText,saveExitText:C.saveExitText,timeSpent:C.timeSpent,studentAnswers:C.studentAnswers,percentCorrect:C.percentCorrect,targetCorrect:C.targetCorrect,dateCompleted:C.dateCompleted,targetAnswers:C.targetAnswers,pictureOptions:C.pictureOptions,reportTitle:C.reportTitle,studentAns2Attempt:C.studentAns2Attempt,studentAns1Attempt:C.studentAns1Attempt,answer1:C.answer1,answer2:C.answer2,passing:C.passing,sortSounds2:C.sortSounds2,reportEmptyMsg:C.reportEmptyMsg,reportEmptyMsg2:C.reportEmptyMsg2};var W=function(e){return angular.element(e)},U=function(){angular.forEach(arguments,function(e,t){})},H=function(){p={chameleonFeeding:new i({target:_.chameleonGreen,frames:54,duration:20,x_pos:0,x_offset:W(_.chameleonGreen).width(),endWithFirstFrame:!0}),chameleonUpset:new i({target:_.chameleonRed,frames:40,duration:20,x_pos:0,x_offset:W(_.chameleonRed).width(),endWithFirstFrame:!0}),pictureTilesLoading:new i({target:_.chameleonGreen,frames:40,duration:20}),gameEnding:new i({target:_.endGameAnim,frames:20,duration:20,x_pos:0,x_offset:W(_.endGameAnim).width()}),chameleonEyeFocus:function(e){var t=W(".chamEye");if(t.length>0){var a=t.offset(),o=a.left+t.width()/2,n=a.top+t.height()/2,i=e.pageX,r=e.pageY,s=Math.atan2(i-o,r-n),d=s*(180/Math.PI)*-1+220;t.css("-moz-transform","rotate("+d+"deg)"),t.css("-webkit-transform","rotate("+d+"deg)"),t.css("-o-transform","rotate("+d+"deg)"),t.css("-ms-transform","rotate("+d+"deg)")}},wink:function(){var e=1,t=1;g=a(function(){W(_.eyeLid).css("height",t+"px"),t+=e,t>=6&&(e=-1),t<=0&&(e=1)},100)},stopWinking:function(){W(_.eyeLid).css("height","0px"),a.cancel(g)},flashPictures:function(){u=a(function(){W(_.activeDraggable).animate({opacity:"0.6"}).animate({opacity:"1"})},1e3)},stopFlashingPictures:function(){W(_.activeDraggable).finish(),a.cancel(u)},animatePlayButton:function(){f=a(function(){W(_.playButton).animate({width:"205px",height:"105px"}).animate({width:"200px",height:"100px"})},1e3)},stopPlayButtonAnimation:function(){W(_.playButton).finish(),a.cancel(f)}}},J=function(o){e.AccCounter=0;var i=ee(I);n(function(){W(".activeDraggable").attr({tabindex:0,"aria-hidden":!1})},1e3);var r=a(function(){W(_.optionPicture).parent().children(".droppedItem").remove(),T=W(_.optionPicture);var s=W(_.questionImage);if(W(_.optionPicture).hide(),n(function(){W(".questionOverlay").hide(),W(_.optionPicture).show()},1e3),d=document.getElementById(_.audioPlayer),d.onended=ge,T.length){var c;a.cancel(r),"false"==w?angular.forEach(T,function(t,a){c=(e.displayedReportData.answerSet[i[a]].relativeZone,0),W(t).attr({src:e.displayedReportData.answerSet[i[a]].image,pictureId:e.displayedReportData.answerSet[i[a]].uniqueId,relativeZone:e.displayedReportData.answerSet[i[a]].relativeZone,wrongAttempts:0,title:e.displayedReportData.answerSet[i[a]].word,musicSrc:e.displayedReportData.answerSet[i[a]].word.replace(/[^a-zA-Z ]/g,"")}),W(t).closest(_.activeDraggable).attr({"aria-label":e.displayedReportData.answerSet[i[a]].word}),W(t).on("click",function(t){if(e.showInfo&&te(),t.stopPropagation(),!b){var a=e.displayedReportData.answerSet[parseInt(W(t.currentTarget).attr("pictureid"))];ge(),q.push(a.audio),me(),e.showCaptions&&(W(_.caption).show(),W(_.captionText).text(a.word))}})}):angular.forEach(T,function(t,a){n(function(){W(t).attr({relativeZone:e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].relativeZone,wrongAttempts:0,src:e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].image,pictureId:e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].uniqueId,title:e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].word,musicSrc:e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].word.replace(/[^a-zA-Z ]/g,""),id:"picture"+e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].uniqueId}),W(".draggable").removeClass("disableClass").addClass("activeDraggable").draggable("enable"),W(t).closest(_.activeDraggable).attr({"aria-label":e.displayedReportData.answerSet[e.currentQuestionV45][i[a]].word}),W(t).on("click",function(t){if(e.showInfo&&te(),t.stopPropagation(),!b){var a=e.displayedReportData.answerSet[e.currentQuestionV45][parseInt(W(t.currentTarget).attr("pictureid"))];ge(),q.push(a.audio),me(),e.showCaptions&&(W(_.caption).show(),W(_.captionText).text(a.word))}})},100)}),angular.forEach(s,function(t,a){W(t).on("click",function(t){e.showInfo&&te(),ge(),""==e.displayedReportData.questionSet[a].audio?q.push(z.notAudio[e.gameStrings.deafaultLanguage],e.displayedReportData.questionSet[a-1].audio):q.push(e.displayedReportData.questionSet[a].audio),me(),e.showCaptions&&(W(_.caption).show(),W(_.captionText).text(e.displayedReportData.questionSet[a].word)),t.stopPropagation()})}),o&&o()}else U("Image elements not loaded yet");e.$emit(t.SAVE_TINCAN_DATA)},200)},j=function(t){var o=ee(I),n=a(function(){T=W(_.optionPicture),R=W(_.oddRhymeFly),V=[],d=document.getElementById(_.audioPlayer),d.onended=ge,W(_.oddRhymeFly).show().removeClass("flySelected, correctFlySelected"),W(".correctFlySelected").removeClass("correctFlySelected"),W(".flySelected").removeClass("flySelected"),T.length?(a.cancel(n),angular.forEach(T,function(t,a){W(t).attr({src:e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].image,pictureId:o[a],title:e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].word,musicSrc:e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].word.replace(/[^a-zA-Z ]/g,"")}),W(t).closest(_.activeDraggable).attr({"aria-label":e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].word}),W(t).on("click",function(t){e.showInfo&&te(),t.stopPropagation();var a=e.displayedReportData.questionSet[e.currentQuestionV45][parseInt(W(t.currentTarget).attr("pictureid"))];ge(),q.push(a.audio),me(a.audio),e.showCaptions&&(W(_.caption).show(),W(_.captionText).text(a.word))})}),angular.forEach(R,function(t,a){var n=e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].answerId,i=e.displayedReportData.questionSet[e.currentQuestionV45][o[a]].word;W(t).attr({answerId:n,flyId:a+1,id:"flyId_"+(a+1),"aria-label":i}),1==n?W(t).addClass("rightFly"):W(t).removeClass("rightFly"),W(t).unbind("click"),W(t).on("click",function(t){4==e.displayedReportData.gameMode&&(B=!0,X(t.currentTarget)),5==e.displayedReportData.gameMode&&(B=!0,Y(t.currentTarget))})}),F=!1,t&&t()):U("Image elements not loaded yet")},200)},Y=function(e){var t=W(e).attr("flyId"),a=W(e).closest(".draggable").find(_.optionPicture);if(V.indexOf(t)>=0){V=[],W(e).removeClass("flySelected");var o=W(e).attr("aria-label").split(" ")[0];W(e).attr("aria-label",o),W(a).removeClass("flySelected")}else{V=[],W(_.flySelected).removeClass("flySelected"),V.push(t),W(e).addClass("flySelected"),W(a).addClass("flySelected");var o=W(e).attr("aria-label")+" selected";W(e).attr("aria-label",o),1==V.length?W(_.chameleonInteraction).attr("aria-label","Press enter to verify your answer."):W(_.chameleonInteraction).attr("aria-label","Select your choice and then press enter to verify your answer.")}},X=function(e){var t=W(e).attr("flyId"),a=V.indexOf(t),o=W(e).closest(".draggable").find(_.optionPicture);if(a>=0){V.splice(a,1),W("[flyId="+t+"]").removeClass("flySelected");var n=W("[flyId="+t+"]").attr("aria-label").split(" ")[0];W("[flyId="+t+"]").attr("aria-label",n),W(o).removeClass("flySelected")}else{if(2==V.length)return;V.push(t),W("[flyId="+t+"]").addClass("flySelected"),W(o).addClass("flySelected");var n=W("[flyId="+t+"]").attr("aria-label")+" selected";W("[flyId="+t+"]").attr("aria-label",n),2==V.length?W(_.chameleonInteraction).attr("aria-label","Press enter to verify your answer."):W(_.chameleonInteraction).attr("aria-label","Select your choice and then press enter to verify your answer.")}},K=function(t){switch(e.displayedReportData.gameMode){case 1:W(_.dropZone).addClass("dzMode1");break;case 2:W(_.dropZone).addClass("dzMode2");break;case 3:W(_.dropZone).addClass("dzMode3");break;default:U("Drop zone(s) are not configured for this game.")}t&&t(me)},ee=function(e){for(var t=[],a=0;a<e;){var o=Math.round(Math.random()*(e-1));t.indexOf(o)>-1||(t.push(o),a++)}return t},te=function(t){e.infoInteraction()},ae=function(e){x=W("#"+O).attr("src"),W("#"+O).attr("src",x),e&&e(ie)},oe=function(t){e.$broadcast("toggleDnd",{elemRef:".draggable",disable:!0}),F||(F=!0,W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),p.chameleonFeeding.reset(),p.chameleonFeeding.play(1),n(function(){W(_.upperSectionCover).show(),ne(O)},50),n(function(){W(c).hide(),W("#"+O).attr("src",""),e.gameCompleted?p.chameleonFeeding.play(15):p.chameleonFeeding.play(),q=[],ge(),4==e.displayedReportData.gameType?(z.itemVo="assets/audios/gameSpecific/"+$("#"+O).attr("musicsrc")+".mp3",q.push(z.rightAction4)):q.push(z.rightAction,z.itemVo),me(),W(h).show(),p.blast=new i({target:h,frames:36,duration:30,x_pos:0,x_offset:W(h).width(),endWithFirstFrame:!1}),p.blast.play(!1,ie)},600))},ne=function(t){var o=document.getElementById(t),n=o.getBoundingClientRect(),i=W(_.chameleonInteraction).position(),r=0,s=i.left+190,d=i.top+83.5,p=i.left,l=i.top+82.5,m=n.left+n.width/2,g=n.top+n.height/2,u=n.left+n.width/2,f=n.top+n.height/2,h=.25*(u-s),y=c.getContext("2d");W(c).show(),h>50&&(h=50),e.engineModeV123?g-=g/7.5:g+=g,y.clearRect(0,0,c.width,c.height),y.strokeStyle="#1a549f",y.beginPath(),y.moveTo(s,d);var v=a(function(){s++,y.lineTo(s,d),y.lineWidth=3,y.stroke(),++r>=h&&(p=s+h,y.strokeStyle=y.createLinearGradient(s,d,m+100,g),y.strokeStyle.addColorStop(0,"#1a549f"),y.strokeStyle.addColorStop(1,"red"),y.bezierCurveTo(p,l,m,g,u,f),y.lineWidth=5,y.stroke(),a.cancel(v))},2.5)},ie=function(){e.$broadcast("toggleDnd",{elemRef:".draggable",disable:!1}),W(_.anchorAnimation).hide(),W("#"+O).attr("src",x),W(_.upperSectionCover).hide(),F=!1},re=function(a,o){if(0!=o){var n=W("[zoneId="+o+"]");de(a,n,!0)}else if(4==e.displayedReportData.gameType){var n=W(".dropZone");de(a,n,!0)}else{W(W(a).closest(".draggable")).draggable("disable"),W(W(a).closest(".draggable")).removeClass("activeDraggable"),W(W(a).closest(".draggable")).addClass("disableClass").attr({tabindex:-1,"aria-hidden":!0});var i={response:W(a).attr("title"),isCorrect:!1};e.sortingResponse[1].push(i),M.push({pictureId:W(a).attr("pictureId"),wrongAttempts:1+parseInt(W(a).attr("wrongAttempts"))}),e.$emit(t.SAVE_TINCAN_DATA)}},se=function(t,a,o,i){S=i;var r=W(t).attr("title");if(o==i)de(t,a),4!=e.displayedReportData.gameType&&(O=W(a).find(_.questionImage).attr("id"),h="#"+W(a).find(_.anchorAnimation).attr("id")),4==e.displayedReportData.gameType?(e.correctAttempted++,l.updateScore()):5==e.displayedReportData.gameType?(W(".questionOverlay").show(),W(a).find(".droppedItem").attr("id","pic1"),n(function(){$(".droppedItemContain").find(".correctDrop").remove()},700),O=W(a).find(".droppedItem").attr("id"),oe(),e.correctAttempted++,l.updateScore()):(l.updateScore(),ae(oe)),5==e.displayedReportData.gameType&&(1!==L&&"-"==e.displayedReportData.userResponses[e.currentQuestionV45].attemp1?e.displayedReportData.userResponses[e.currentQuestionV45].attemp1=r:e.displayedReportData.userResponses[e.currentQuestionV45].attemp2=r),n(function(){5!=e.displayedReportData.gameType||"true"!=w||e.gameCompleted||(W(a).children(".droppedItemContain").remove(),e.currentQuestionV45++,J(K),W(".questionOverlay").hide(),L=D.displayConfig)},3500);else{var s=1+parseInt(W(t).attr("wrongAttempts"));W(t).attr("wrongAttempts",s),s>=D.chances&&re(t,o),ge(),q=[],z.itemVo="assets/audios/gameSpecific/"+W(t).attr("musicsrc")+".mp3",4==e.displayedReportData.gameType?q.push(z.wrongAction4):q.push(z.wrongAction,z.itemVo),me(),W(_.chameleonRed).show(),W(_.chameleonGreen).hide(),p.chameleonUpset.reset(),p.chameleonUpset.play(),"false"==w&&1==e.displayedReportData.gameMode?(de(t,a,!0),n(function(){W(a).children(".incorrectDrop").remove()},500)):n(function(){W(".droppedItemContain").children(".incorrectDropIcon").remove()},500),n(function(){if(5==e.displayedReportData.gameType){if(2==--L){var t=W(".draggable").find('img[relativezone="1"]');de(t,a,!1),W(".questionOverlay").show(),ge(),q=[],z.itemVo="assets/audios/gameSpecific/"+W(t).attr("musicsrc")+".mp3",q.push(z.itemVo),me(),n(function(){W(".questionOverlay").hide(),W(a).children(".correctDrop").remove(),5!=e.displayedReportData.gameType||"true"!=w||e.gameCompleted||(W(a).children(".droppedItemContain").remove(),e.currentQuestionV45++,J(K),L=D.displayConfig)},3500)}1!==L?e.displayedReportData.userResponses[e.currentQuestionV45].attemp1=r:1==L&&(e.displayedReportData.userResponses[e.currentQuestionV45].attemp2=r)}},500)}},de=function(a,o,i){var r=!0,s=parseInt(W(o).attr("zoneId"))-1,d={pictureId:W(a).attr("pictureId"),wrongAttempts:parseInt(W(a).attr("wrongAttempts"))};if(1==i){if(3==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain3'></div>");else if(4==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain4'></div>");else if(5==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain5'></div>");else var c=W("<div class='droppedItemContain'></div>");c.append(W(a).clone().addClass("droppedItem")),c.append(W(e.incorrectItem).clone().addClass("showItem incorrectDrop incorrectDropIcon")),W(o).append(c.addClass("incorrectDrop").css({})),r=!1}else{if(3==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain3'></div>");else if(4==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain4'></div>");else if(5==D.gameType)var c=W("<div class='droppedItemContain droppedItemContain5'></div>");else var c=W("<div class='droppedItemContain'></div>");c.append(W(a).clone().addClass("droppedItem")),3==L&&5==D.gameType?c.append(W(e.correctItem2).clone().addClass("showItem correctDrop")):(L<3&&D.gameType,c.append(W(e.correctItem).clone().addClass("showItem correctDrop"))),W(o).append(c),5==D.gameType&&n(function(){W(".droppedItemContain").children(".incorrectDrop").remove()},500)}if(z.itemVo="assets/audios/gameSpecific/"+W(a).attr("musicsrc")+".mp3",z.itemVo1="assets/audios/gameSpecific/"+W(a).attr("musicsrc")+".mp3",M.push(d),(1!=D.gameType||2!=S&&!i)&&e.rightOptionsAttemptedV123++,L--,W(a).hide(),4==D.gameType&&W(".droppedItem").show(),4!=D.gameType||0!=i){(e.rightOptionsAttemptedV123==D.correctAnswers||5!=D.gameType&&0==L)&&4!=D.gameType&&(W(_.upperSectionCover).show(),n(function(){e.currentQuestionV45++,e.gameCompleted=!0},1e3));var p={response:W(a).attr("title"),isCorrect:r};e.sortingResponse[s].push(p),e.displayedReportData.zoneResponses=e.sortingResponse,e.fullGameReport.zoneResponses=e.sortingResponse,e.$emit(t.SAVE_TINCAN_DATA)}},ce=function(){if(P>=3){var t;V=[],5==e.displayedReportData.gameMode&&(t=W(".rightFly").attr("flyId"),V.push(t)),4==e.displayedReportData.gameMode&&(t=W(".rightFly"),V.push(W(t[0]).attr("flyId"),W(t[1]).attr("flyId"))),e.tasteFly(!0)}},pe=function(){console.log("restoreGameV123"),e.showSplashScreen||(q=[],ge()),angular.forEach(y.savedState.droppedPictures,function(t,a){var o=W("[pictureId="+t.pictureId+"]"),n=W(o).attr("relativeZone");if(e.correctItem||(e.correctItem='<div class="correctItem showItem correctDrop"></div>'),W(o).attr("wrongAttempts",t.wrongAttempts),t.wrongAttempts>=D.chances)re(o,n);else{var i=W("[zoneId="+n+"]");de(o,i),l.updateScore()}}),n(function(){angular.forEach(y.savedState.droppedPictures,function(e,t){var a=W(".pictureBox [pictureId="+e.pictureId+"]");W(a).hide()})},1010)},le=function(){l.setScore(y.savedState.gameScore),e.currentQuestionV45=y.savedState.currentQuestionV45,e.sortingResponse[0]=y.savedState.sortingResponse,e.avgPecentage=e.currentScore/e.maxScore*100,J()},me=function(){q.length&&(d.setAttribute("src",""),d.setAttribute("src",q[0]),d.play(),q.splice(0,1))},ge=function(){U("caption ended"),q.length?me():(d.setAttribute("src",""),W(_.captionText).text(""),W(".caption").hide(),e.startClicked&&(e.startClicked=!1,e.closeInfo()))};e.init=function(){myConsole.value="Game Loaded";var o=window,i=document,m=i.documentElement,g=i.getElementsByTagName("body")[0],u=o.innerWidth||m.clientWidth||g.clientWidth,f=o.innerHeight||m.clientHeight||g.clientHeight;if(c=document.getElementById("canvas"),c.setAttribute("width",u),c.setAttribute("height",f),W(c).hide(),H(),p.animatePlayButton(),W(_.endGameAnim).hide(),W(_.endGamePopup).hide(),W(_.gameOverlay).hide(),v=new s,v.start(),e.progressData=new Array(e.displayedReportData.answerSet.length),4!=D.gameType&&5!=D.gameType||(W(_.dropZone).addClass("zoneType45"),W(".DndWrapper").addClass("increaseBottom"),4==D.gameType&&W(_.dropZone).addClass("zoneType4")),e.engineModeV123?(J(K),W(_.upperSectionCover).hide(),W(_.anchorAnimation).hide(),l=new r(D.correctAnswers)):(j(K),l=new r(e.displayedReportData.questionSet.length),e.totalFlowers=new Array(e.displayedReportData.questionSet.length),W(_.chameleonInteraction).css("cursor","pointer")),!e.engineModeV123)var h=a(function(){W(".draggable").length&&(W(".draggable").draggable("disable"),a.cancel(h))},200);e.setWaitTimer(),AccessibilityManager.registerActionHandler("selectDraggables",".pictureBox .activeDraggable","",function(t){G=this,(++e.AccCounter<=2&&4==e.displayedReportData.gameType||5==e.displayedReportData.gameType&&(e.AccCounter<=1||L>=3))&&(AccessibilityManager.setTabGroup("dropZones"),AccessibilityManager.updateTabOrder("dropZones",function(){AccessibilityManager.enableElements([".dropZone"]),AccessibilityManager.setFocus(".dropZone[zoneid=1]")}))}),AccessibilityManager.registerActionHandler("dropDraggables",".dropZone","",function(a){e.correctItem=W(G).find(".correctItem")[0],e.incorrectItem=W(G).find(".incorrectItem")[0],e.correctItem2=W(G).find(".correctItem2")[0];var o=W(G).find("img")[0],i=this,r=W(o).attr("relativeZone"),s=W(i).attr("zoneId");4!=e.displayedReportData.gameType?se(o,i,r,s):ue(o,i,r,s),n(function(){AccessibilityManager.setTabGroup("pictureTiles"),AccessibilityManager.updateTabOrder("pictureTiles",function(){G=void 0;for(var e=0;e<I;e++)if(W(W(_.optionPicture+":visible")[e]).closest(".draggable").hasClass("activeDraggable")){W(W(_.optionPicture+":visible")[e]).closest(_.activeDraggable).focus();break}})},400),AccessibilityManager.disableElements([".dropZone"]),e.$emit(t.SAVE_TINCAN_DATA)}),d=document.getElementById(_.audioPlayer),d.onended=ge,d.setAttribute("src",e.gameInfoAudio),d.play(),n(function(){},1e3)},e.tasteFly=function(t){if(!F){if("game_4"==e.displayedReportData.gameName&&2==V.length){F=!0;var a=[{fly:void 0,picture:void 0},{fly:void 0,picture:void 0}];angular.forEach(V,function(e,t){a[t].fly=W("[flyId="+V[t]+"]"),a[t].picture=W("[flyId="+V[t]+"]").closest(".draggable").find(_.optionPicture)}),1==W(a[0].fly).attr("answerId")&&1==W(a[1].fly).attr("answerId")?(W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),p.chameleonFeeding.reset(),p.chameleonFeeding.play(1),ne(W(a[0].fly).attr("id")),n(function(){W(c).hide(),W(a[0].fly).removeClass("flySelected").addClass("correctFlySelected"),W(a[0].fly).hide()},500),n(function(){ne(W(a[1].fly).attr("id"))},1e3),n(function(){if(W(a[0].picture).removeClass("flySelected").addClass("correctFlySelected"),W(a[1].fly).removeClass("flySelected").addClass("correctFlySelected"),W(a[1].picture).removeClass("flySelected").addClass("correctFlySelected"),W(a[1].fly).hide(),e.currentQuestionV45++,t){var o={response:W(a[0].picture).attr("title")+", "+W(a[1].picture).attr("title"),isCorrect:!1};e.sortingResponse[0].push(o)}else{var o={response:W(a[0].picture).attr("title")+", "+W(a[1].picture).attr("title"),isCorrect:!0};e.sortingResponse[0].push(o),l.updateScore()}P=0,W(c).hide(),p.chameleonFeeding.play(!1,j),ge(),q=[],4==D.gameType?q.push(z.rightAction4,z.itemVo,z.itemVo1):q.push(z.rightAction,z.itemVo),me(),e.totalFlowers.pop(),W(_.oddRhymeFly)[0].focus()},1500)):(W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),p.chameleonUpset.reset(),p.chameleonFeeding.reset(),p.chameleonFeeding.play(1),ne(W(a[0].fly).attr("id")),n(function(){W(c).hide(),
W(a[0].fly).removeClass("flySelected"),W(a[0].fly).hide()},500),n(function(){ne(W(a[1].fly).attr("id"))},1e3),n(function(){W(a[0].picture).removeClass("flySelected"),W(a[1].fly).removeClass("flySelected"),W(a[1].picture).removeClass("flySelected"),W(a[1].fly).hide(),P++,W(c).hide(),V=[],W(_.chameleonRed).show(),W(_.chameleonGreen).hide(),p.chameleonUpset.play(!1,ce),ge(),q=[],4==D.gameType?q.push(z.wrongAction4):q.push(z.wrongAction,z.itemVo),me(),n(function(){W(a[0].fly).show(),W(a[1].fly).show(),W(_.oddRhymeFly)[0].focus(),F=!1},500)},1500))}if(5==e.displayedReportData.gameMode&&1==V.length){F=!0;var a={fly:W("[flyId="+V[0]+"]"),picture:W("[flyId="+V[0]+"]").closest(".draggable").find(_.optionPicture)};1==W(a.fly).attr("answerId")?(W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),p.chameleonFeeding.reset(),p.chameleonFeeding.play(1),V=[],W(a.fly).removeClass("flySelected").addClass("correctFlySelected"),W(a.picture).removeClass("flySelected").addClass("correctFlySelected"),P=0,ne(W(a.fly).attr("id")),n(function(){if(W(a.fly).hide(),W(c).hide(),e.currentQuestionV45++,t){var o={response:W(a.picture).attr("title"),isCorrect:!1};e.sortingResponse[0].push(o)}else{var o={response:W(a.picture).attr("title"),isCorrect:!0};e.sortingResponse[0].push(o),l.updateScore()}p.chameleonFeeding.play(!1,j),ge(),q=[],4==D.gameType?q.push(z.rightAction4,z.itemVo,z.itemVo1):q.push(z.rightAction,z.itemVo),me(),e.totalFlowers.pop(),W(_.oddRhymeFly)[0].focus()},1e3)):(W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),p.chameleonUpset.reset(),p.chameleonFeeding.reset(),p.chameleonFeeding.play(1),V=[],W(a.fly).removeClass("flySelected"),W(a.picture).removeClass("flySelected"),P++,ne(W(a.fly).attr("id")),n(function(){W(c).hide(),W(a.fly).hide(),W(_.chameleonRed).show(),W(_.chameleonGreen).hide(),p.chameleonUpset.play(!1,ce),ge(),q=[],4==D.gameType?q.push(z.wrongAction4):q.push(z.wrongAction,z.itemVo),me()},1e3),n(function(){W(a.fly).show(),W(_.oddRhymeFly)[0].focus(),F=!1},1500))}}},e.closeInfo=function(t){t&&t.stopPropagation(),q=[],W(_.infoIcon).hasClass("infoIconActive")&&n(function(){e.showInfo=!1,W(_.infoPopup).css("display","none !important"),W(_.infoIcon).removeClass("infoIconActive"),W(_.infoAudioIcon).removeClass("audioDisble"),ge()},100),AccessibilityManager.setFocus(".gameScreen .infoIcon")},e.infoInteraction=function(t){t&&t.stopPropagation(),W(_.infoIcon).hasClass("infoIconActive")?n(function(){e.showInfo=!1,W(_.infoPopup).css("display","none !important"),W(_.infoIcon).removeClass("infoIconActive"),q=[],ge()},0):n(function(){e.showInfo=!0,W(_.infoIcon).addClass("infoIconActive"),W(_.infoVoIcon).removeClass("infoVoIconActive"),W(_.infoPopup).css("display","inline-block"),d=document.getElementById(_.audioPlayer),d.onended=ge;var t="assets/audios/info/"+o.getConfigData().gameLocale+"/",a=D.infoAudios;q=[],e.startClicked&&(1==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio2,t+a[2],e.infoAudio.audio1,t+a[3],t+a[4]):2==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio1,t+a[2],e.infoAudio.audio2,t+a[3],e.infoAudio.audio2,t+a[4]):3==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio1,t+a[2],e.infoAudio.audio2,t+a[3],e.infoAudio.audio2,t+a[4],e.infoAudio.audio3,t+a[5],e.infoAudio.audio3,t+a[6]):q.push(t+a),me())},0),n(function(){AccessibilityManager.setTabGroup("lnstruction"),AccessibilityManager.updateTabOrder("lnstruction",function(){AccessibilityManager.setFocus(".gameScreen .infoAudioIcon")})},400)},e.playInfoVO=function(e){},e.resetInteraction=function(t){for(var a=0;a<e.displayedReportData.questionSet.length;a++)$("#questionImage_"+(a+1)).attr("src",e.displayedReportData.questionSet[a].image);e.showDialog=!1,e.openOptionsDialog=!1,e.openReportDialog=!1,e.currentQuestionV45=0,(e.gameCompleted||t)&&(e.showSplashScreen=!0,e.gameCompleted=!1,clearTimeout(yourTimer),e.resetButtonState="Disabled",e.engineModeV123?(angular.forEach(T,function(e,t){W(e).attr({src:"",pictureId:"",relativeZone:"",tabindex:"","aria-hidden":""})}),W(_.droppedItemContain).remove(),J(K),M=[],e.rightOptionsAttemptedV123=0,L=D.displayConfig,e.engineModeV123&&(W(".draggable").draggable("enable").css({opacity:"1","pointer-events":"auto","-webkit-filter":"grayscale(0%)",filter:"grayscale(0%)"}).removeAttr("aria-hidden").addClass("activeDraggable"),angular.forEach(W(".draggable"),function(e,t){0==W(e).attr("item")&&W(e).removeClass("activeDraggable")})),W(_.upperSectionCover).hide(),W(_.anchorAnimation).hide()):(W(_.upperSection).show(),e.currentQuestionV45=0,e.totalFlowers=new Array(e.displayedReportData.questionSet.length),j(K)),l.reset(),e.setWaitTimer(),W(_.endGameAnim).hide(),W(_.endGamePopup).hide(),W(_.gameOverlay).hide(),ge(),p.chameleonFeeding.showFirstFrame(),p.chameleonUpset.showFirstFrame(),W(_.chameleonGreen).css({"background-image":"url(assets/images/green.png)","background-position":"0 0"}),H(),p.animatePlayButton(),e.sortingResponse={0:[],1:[],2:[]},e.$emit("initAccessibility"),e.$emit("SUBMIT_TINCAN_DATA")),1==t&&(ge(),q=[],e.playGame("",!0))},e.ccInteraction=function(){W(_.ccIcon).hasClass("ccIconActive")?(e.showCaptions=!1,e.ccButtonState="Disabled",W(_.ccIcon).removeClass("ccIconActive")):(e.showCaptions=!0,e.ccButtonState="",W(_.ccIcon).addClass("ccIconActive"))},e.simpleClickInteraction=function(){W(_.infoIcon).hasClass("infoIconActive")&&(W(_.infoIcon).removeClass("infoIconActive"),e.showInfo=!1),q=[],ge()},e.repeatBound=function(e){return N[I][e]},e.followMousePos=function(t){p.chameleonEyeFocus(t),e.resetWaitTimer()},e.setWaitTimer=function(){m=n(function(){p.stopWinking(),p.wink()},3e4)},e.resetWaitTimer=function(){p.stopWinking(),n.cancel(m),e.setWaitTimer()},e.toggleTabs=function(e){W("."+W(".selectedTab").attr("content")).hide(),W(".selectedTab").removeClass("selectedTab"),W(e.currentTarget).addClass("selectedTab"),W("."+W(e.currentTarget).attr("content")).show()},e.manageSplashAudio=function(t){t&&t.stopPropagation(),n(function(){d=document.getElementById(_.audioPlayer),d.onended=ge,d.setAttribute("src",e.gameInfoAudio),d.play()},0)},e.manageinfoPopupAudio=function(t){t&&t.stopPropagation(),n(function(){ge();var t="assets/audios/info/"+o.getConfigData().gameLocale+"/",a=D.infoAudios;console.log("audioSrc==",t+a[0]),q=[],1==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio2,t+a[2],e.infoAudio.audio1,t+a[3],t+a[4]):2==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio1,t+a[2],e.infoAudio.audio2,t+a[3],e.infoAudio.audio2,t+a[4]):3==D.gameType?q.push(t+a[0],e.infoAudio.audio1,t+a[1],e.infoAudio.audio1,t+a[2],e.infoAudio.audio2,t+a[3],e.infoAudio.audio2,t+a[4],e.infoAudio.audio3,t+a[5],e.infoAudio.audio3,t+a[6]):q.push(t+a),me()},0)},e.playGame=function(t,a){void 0!=t&&void 0==a&&t.stopPropagation(),ge(),e.showSplashScreen=!1,e.displayedReportData.userResponses=[],p.stopPlayButtonAnimation(),te(),e.startClicked=!0,e.gameStartTime=new Date,e.displayedReportData.startTime=e.gameStartTime;for(var o=0;o<e.displayedReportData.answerSet.length;o++)e.displayedReportData.userResponses.push({word:"",attemp1:"-",attemp2:"-"});n(function(){AccessibilityManager.setTabGroup("lnstruction"),AccessibilityManager.updateTabOrder("lnstruction",function(){AccessibilityManager.setFocus(".gameScreen .infoAudioIcon")})},400),n(function(){W(".row-1").height()},2e3)};var ue=function(t,a,o,i){var r=W("<div class='droppedItemContain droppedItemContain4'></div>");if(r.append($(t).clone().addClass("droppedItem")),$(a).append(r),$(t).hide(),E.push([t,a,o,i]),2==E.length){W(".questionOverlay").show(),W(a).children(".droppedItemContain").remove();for(var s=0;s<E.length;s++)se(E[s][0],E[s][1],E[s][2],E[s][3]);2==e.correctAttempted&&(W(a).find(".droppedItem:eq(0)").attr("id","pic1"),n(function(){$(".droppedItemContain").eq(0).find(".correctDrop").remove()},700),O=W(a).find(".droppedItem:eq(0)").attr("id"),z.itemVo="assets/audios/gameSpecific/"+W(a).find(".droppedItem:eq(0)").attr("musicsrc")+".mp3",q.push(z.itemVo),me(),oe(),n(function(){W(a).find(".droppedItem:eq(1)").attr("id","pic2"),n(function(){$(".droppedItemContain").eq(1).find(".correctDrop").remove()},700),O=W(a).find(".droppedItem:eq(1)").attr("id"),z.itemVo="assets/audios/gameSpecific/"+W(a).find(".droppedItem:eq(1)").attr("musicsrc")+".mp3",q.push(z.itemVo),me(),oe()},3e3)),n(function(){if(2!=e.correctAttempted){W(a).children(".droppedItemContain").remove();var t=W(".draggable").find('img[relativezone="1"]');q=[],ge();for(var o=0;o<t.length;o++)de(t[o],a,!1),z.itemVo="assets/audios/gameSpecific/"+W(t[o]).attr("musicsrc")+".mp3",q.push(z.itemVo);me()}},1e3),n(function(){2==e.correctAttempted&&($(".droppedItemContain").eq(1).find(".correctItem").remove(),$(".droppedItemContain").eq(1).find(".correctItem2").remove()),e.currentQuestionV45++,E.length=0,e.correctAttempted=0,e.currentQuestionV45==e.displayedReportData.answerSet.length?(W(_.upperSectionCover).show(),n(function(){W(".questionOverlay").show(),e.gameCompleted=!0},1e3)):(W(a).children(".droppedItemContain").remove(),J(K))},5e3)}};e.$on("ItemDragStarted",function(e,t){U("drag started"),b=!0,A={},A.top=W(t.event.target).css("top"),A.left=W(t.event.target).css("left")}),e.$on("ItemDropped",function(t,a){var o=W(a.ui.draggable[0]).find("img")[0];e.correctItem=W(a.ui.draggable[0]).find(".correctItem")[0],e.incorrectItem=W(a.ui.draggable[0]).find(".incorrectItem")[0],e.correctItem2=W(a.ui.draggable[0]).find(".correctItem2")[0];var n=a.event.target,i=W(o).attr("relativeZone"),r=W(n).attr("zoneId");4!=D.gameType?se(o,n,i,r):ue(o,n,i,r)}),e.$on("ItemDragStopped",function(e,t){b=!1}),e.$on("ItemDraggedOver",function(e,t){}),e.$on("ItemDraggedOut",function(e,t){}),e.activateKeyboardDnd=function(){$("body").on("keydown",function(a){if(9!=a.which&&9!=a.keyCode||e.resetWaitTimer(),27==a.keyCode&&(G=void 0),13==a.keyCode&&$(a.target).hasClass("draggable")&&!$(a.target).hasClass("droppedItem")&&(G=a.target),13==a.keyCode&&G&&$(a.target).hasClass("dropZone")){var o=W(G).find("img")[0];e.correctItem=W(G).find(".correctItem")[0],e.incorrectItem=W(G).find(".incorrectItem")[0],e.correctItem2=W(G).find(".correctItem2")[0];var n=a.target,i=W(o).attr("relativeZone"),r=W(n).attr("zoneId");4!=D.gameType?se(o,n,i,r):ue(o,n,i,r),G=void 0,e.$emit(t.SAVE_TINCAN_DATA)}}),$("body").on("touchstart",function(a){if(e.resetWaitTimer(),$(a.target).hasClass("draggable")&&!$(a.target).hasClass("droppedItem"))G=a.target;else if(G&&$(a.target).hasClass("dropZone")){var o=W(G).find("img")[0];e.correctItem=W(G).find(".correctItem")[0],e.incorrectItem=W(G).find(".incorrectItem")[0],e.correctItem2=W(G).find(".correctItem2")[0];var n=a.target,i=W(o).attr("relativeZone"),r=W(n).attr("zoneId");4!=D.gameType?se(o,n,i,r):ue(o,n,i,r),G=void 0,e.$emit(t.SAVE_TINCAN_DATA)}else G=void 0})},e.activateDnd=function(t){t?e.$broadcast("toggleDnd",{elemRef:".draggable",disable:!1}):e.$broadcast("toggleDnd",{elemRef:".draggable",disable:!0})},e.restoreDragPosition=function(){A&&(W(".draggable").css({top:A.top,left:A.left}),setTimeout(function(){W(".draggable").removeAttr("style")},10))},e.generateReport=function(){if(void 0!==e.fullGameReport.gameName){if(4==D.gameType){var t=e.fullGameReport.zoneResponses[0];console.log("zoneResponse.length",t.length);for(var a=0;a<t.length;a+=2)0==t[a].isCorrect?t[a+1].isCorrect=!1:0==t[a+1].isCorrect&&(t[a].isCorrect=!1)}e.showReport=!0,e.optionArr=[],e.targetWordArr=[],1==D.gameType||2==D.gameType||3==D.gameType?e.reportTableHeading=[e.gameStrings.targetCorrect.toUpperCase(),e.gameStrings.studentAnswers.toUpperCase(),e.gameStrings.percentCorrect.toUpperCase(),e.gameStrings.timeSpent.toUpperCase(),e.gameStrings.dateCompleted.toUpperCase()]:4==D.gameType?e.reportTableHeading=[e.gameStrings.pictureOptions.toUpperCase(),e.gameStrings.targetAnswers.toUpperCase(),e.gameStrings.studentAnswers.toUpperCase(),e.gameStrings.percentCorrect.toUpperCase(),e.gameStrings.timeSpent.toUpperCase()]:5==D.gameType&&(e.reportTableHeading=[e.gameStrings.pictureOptions.toUpperCase(),e.gameStrings.targetAnswers.toUpperCase(),e.gameStrings.answer1.toUpperCase(),e.gameStrings.answer2.toUpperCase(),e.gameStrings.percentCorrect.toUpperCase(),e.gameStrings.timeSpent.toUpperCase()]);for(var a=0;a<e.fullGameReport.answerSet.length;a++){for(var o=[],n=[],i=0;i<e.fullGameReport.answerSet[a].length;i++)o.push(e.fullGameReport.answerSet[a][i].word),1==e.fullGameReport.answerSet[a][i].relativeZone&&n.push(e.fullGameReport.answerSet[a][i].word);e.optionArr.push(o),e.targetWordArr.push(n)}for(var a=0;a<e.targetWordArr.length;a++)e.fullGameReport.userResponses[a].word=e.targetWordArr[a][0]}else e.blankReport=!0},e.downloadReport=function(t){var a=e.fullGameReport,o="",n=e.gameStrings.reportTitle,i=(e.gameStrings.sortSounds2,e.gameStrings.passing);if(console.log("tincanData",y),void 0===y){var r="ID-5225";console.log("tincanData undefined")}else if(null==y.userDetails||void 0==y.userDetails){var r="ID-5225";console.log("if condition downloadReport",y,r)}else{var r=y.userDetails.userId;console.log("else condition downloadReport",y,r)}var s=e.title2;if(1==a.gameType||2==a.gameType||a.gameType,o+=n+"\r\n"+s+"\r\n"+i+"\r\n\n"+r+"\r\n\n\n",1==a.gameType||2==a.gameType||3==a.gameType)var d=[e.gameStrings.targetCorrect,e.gameStrings.studentAnswers,e.gameStrings.percentCorrect,e.gameStrings.timeSpent,e.gameStrings.dateCompleted];if(4==a.gameType)var d=[e.gameStrings.pictureOptions,e.gameStrings.targetAnswers,e.gameStrings.studentAnswers,e.gameStrings.percentCorrect,e.gameStrings.timeSpent,e.gameStrings.dateCompleted];if(5==a.gameType)var d=[e.gameStrings.pictureOptions,e.gameStrings.targetAnswers,e.gameStrings.studentAns1Attempt,e.gameStrings.studentAns2Attempt,e.gameStrings.percentCorrect,e.gameStrings.timeSpent,e.gameStrings.dateCompleted];for(var c="",p=0;p<d.length;++p)c+=d[p]+",";if(c=c.slice(0,-1),o+=c+"\r\n",1!=a.gameType&&2!=a.gameType&&3!=a.gameType||(c=a.gameTopic+",,"+a.percentCorrect+","+a.timeSpent+","+a.dateCompleted),4==a.gameType&&(c=",,,"+a.percentCorrect+","+a.timeSpent+","+a.dateCompleted),5==a.gameType&&(c=",,,,"+a.percentCorrect+","+a.timeSpent+","+a.dateCompleted),o+=c+"\r\n",1==a.gameType||2==a.gameType||3==a.gameType)for(var l in a.zoneResponses){var m=parseInt(l),c="";if(a.zoneResponses[m]!=[])for(var g=0;g<a.zoneResponses[m].length;++g)c=0==g?a.questionSet[m].title+", ":" , ",c=c+a.zoneResponses[m][g].response+", , ,",o+=c+"\r\n"}var u=a.zoneResponses[0];if(4==a.gameType)for(var l=0;l<a.answerSet.length;l++){for(var f=a.answerSet[l],c="",h="",v="",S="",g=0;g<f.length;g++)g!==f.length-1?h+=f[g].word+" ":h+=f[g].word;S=e.targetWordArr[l][0]+" "+e.targetWordArr[l][1],v+=u[2*l].response+" "+u[2*l+1].response,c=h+","+S+","+v+",,,",o+=c+"\r\n"}if(5==a.gameType)for(var l=0;l<a.answerSet.length;l++){for(var f=a.answerSet[l],c="",h="",g=0;g<f.length;g++)g!==f.length-1?h+=f[g].word+" ":h+=f[g].word;c=h+","+a.userResponses[l].word+","+a.userResponses[l].attemp1+","+a.userResponses[l].attemp2+",,,",o+=c+"\r\n"}if(""==o)return void alert("Invalid data");var D="MyReport_";D+=n.replace(/ /g,"_"),D+=".xlsx",e.createXLS(o,D,a)},e.createXLS=function(e,t,a){var o=e.split("\n"),n=$JExcel.new("Calibri 10 #000000");n.set({sheet:0,value:"Report"}),n.addSheet("Sheet 2");for(var i=n.addStyle({font:"Calibri 14 #000000 B",fill:"#F0F0F0",align:"L L"}),r=n.addStyle({font:"Calibri 14 #000000 B",fill:"#F0F0F0",align:"L L"}),s=n.addStyle({font:"Calibri 14 #000000 B",fill:"#F0F0F0",align:"L L"}),d=(n.addStyle({border:"null,null,thin,null #333333"}),n.addStyle({border:"null,thin,null,null #333333",fill:"#F0F0F0"})),c=o[7].split(","),p=n.addStyle({border:"thin,thin,thin,thin #333333",font:"Calibri 12 #000 B",fill:"#F0F0F0",align:"L L"}),l=n.addStyle({font:"Calibri 12 #000000 B",border:"thin,thin,thin,thin #333333",fill:"#F0F0F0",align:"L L"}),m=0;m<c.length;m++)n.set(0,m,4,c[m].trim(),p),5==a.gameType&&n.set(0,m,4,c[m].trim(),l),n.set(0,m,void 0,"auto"),m<c.length-2?n.set(0,m,void 0,25):n.set(0,m,void 0,37),5==a.gameType&&(n.set(0,m,void 0,25),0!=m&&2!=m&&3!=m||n.set(0,m,void 0,37)),m<c.length-1&&(n.set(0,m,0,"",i),n.set(0,m,1,"",r),n.set(0,m,2,"",r),n.set(0,m,3,"",s)),1==a.gameType||2==a.gameType||3==a.gameType?n.set(0,4,m-1,"",d):4==a.gameType?n.set(0,5,m-2,"",d):n.set(0,6,m,"",d),0==m&&n.set(0,m,0,"",i);n.set(0,0,0,o[0].trim(),i),n.set(0,0,1,o[1].trim(),r),n.set(0,0,2,o[2].trim(),r),n.set(0,0,3,o[4].trim(),s),n.set(0,0,void 0,25);var g=n.addStyle({border:"thin,thin,thin,thin #333333",align:"L L"}),u=n.addStyle({border:"thin,thin,thin,thin #ffffff",fill:"#3d3d3d",font:"Calibri 12 #ffffff",align:"L L"}),f=n.addStyle({border:"thin,thin,thin,thin #333333",fill:"#FAFAD2",align:"L L"}),h=n.addStyle({border:"thin,thin,thin,thin #333333",fill:"#B3F39E",align:"L L"}),y=n.addStyle({border:"thin,thin,thin,thin #333333",fill:"#B3F39E",font:"Calibri 10 #333333 B",align:"L L"}),v=n.addStyle({border:"thin,thin,thin,thin #333333",fill:"#F79898",align:"L L"}),S=n.addStyle({fill:"#F79898",border:"thin,thin,thin,thin #333333",font:"Calibri 10 #333333 B",align:"L L"}),D=a.zoneResponses[0];a.zoneResponses[1],a.zoneResponses[2];if(1==a.gameType||2==a.gameType||3==a.gameType)for(var I=a.zoneResponses,m=8;m<o.length;m++){var w=o[m].split(",");if(w.length>=c.length)for(var C=0;C<w.length;C++)if(n.set(0,C,m-3,w[C].trim(),g),8==m&&n.set(0,C,m-3,w[C].trim(),u),m>8&&1==C)for(k in I)for(var A=I[k],b=0;b<A.length;b++)w[C].trim()===A[b].response.trim()&&(A[b].isCorrect?n.set(0,C,m-3,w[C].trim(),y):n.set(0,C,m-3,w[C].trim(),S))}if(4==a.gameType)for(var m=8;m<o.length-1;m++)for(var w=o[m].split(","),C=0;C<w.length;C++)C<=2&&(w[C]=w[C].split(" ").join(", ")),n.set(0,C,m-3,w[C].trim(),g),8==m&&n.set(0,C,m-3,w[C].trim(),u),w[C]&&C==c.length-4&&8!=m&&(1==D[2*(m-9)].isCorrect&&1==D[2*(m-9)+1].isCorrect?n.set(0,C,m-3,w[C].trim(),h):n.set(0,C,m-3,w[C].trim(),v));if(5==a.gameType)for(var m=8;m<o.length-1;m++)for(var w=o[m].split(","),C=0;C<w.length;C++)0==C&&(w[C]=w[C].split(" ").join(", "),m>8&&(w[C]=m-8+". "+w[C])),n.set(0,C,m-3,w[C].trim(),g),8==m&&n.set(0,C,m-3,w[C].trim(),u),w[C]&&C>=c.length-5&&8!=m&&(w[C].trim().toLowerCase()==w[c.length-6].trim().toLowerCase()?n.set(0,C,m-3,w[C].trim(),h):"-"!==w[C].trim().toLowerCase()&&""!==w[C].trim().toLowerCase()&&n.set(0,C,m-3,w[C].trim(),v)),w[C]&&C==c.length-6&&(w[C].trim().toLowerCase()==w[c.length-5].trim().toLowerCase()?n.set(0,C,m-3,w[C].trim(),h):w[C].trim().toLowerCase()==w[c.length-4].trim().toLowerCase()?n.set(0,C,m-3,w[C].trim(),f):n.set(0,C,m-3,w[C].trim(),v));n.generate(t)},e.closeReport=function(){e.showReport=!1},e.closeBlankReport=function(){e.blankReport=!1},e.$watch("currentQuestionV45",function(){"false"==w?(e.currentQuestionV45>=e.displayedReportData.questionSet.length&&(e.gameCompleted=!0),e.$emit(t.SAVE_TINCAN_DATA)):(e.currentQuestionV45>=e.displayedReportData.answerSet.length&&(e.gameCompleted=!0),e.$emit(t.SAVE_TINCAN_DATA))}),e.$watch("gameCompleted",function(){n(function(){e.gameCompleted&&(W(".questionOverlay").hide(),e.levelEndTime=new Date,e.displayedReportData.endTime=e.levelEndTime,e.resetButtonState="",W(_.upperSectionCover).show(),W(_.chameleonGreen).show(),W(_.chameleonRed).hide(),e.avgPecentage>=70&&W(_.endGameAnim).show(),W(_.endGamePopup).show(),W(_.gameOverlay).show(),e.displayedReportData.timeSpent=e.millisToMinutesAndSeconds(e.levelEndTime-new Date(e.displayedReportData.startTime)),e.displayedReportData.dateCompleted=e.getDateString(e.levelEndTime)+" "+e.getTimeString(e.levelEndTime),yourTimer=setTimeout(function(){W(_.upperSectionCover).show(),e.avgPecentage>=70&&W(_.chameleonGreen).css({"background-image":"url(assets/images/chameleonGreen.PNG)","background-position":"1px 0"}),ge(),"en"==e.gameStrings.deafaultLanguage?(z.numberVo="assets/audios/number/Number_"+e.currentScore+".mp3",z.maxNumberVo="assets/audios/number/Number_"+e.maxScore+".mp3",e.avgPecentage>=70?q.push(z.end1,z.numberVo,z.end2,z.maxNumberVo,z.end3):q.push(z.end4,z.numberVo,z.end2,z.maxNumberVo,z.end5)):(z.numberVo="assets/audios/number/SS_"+e.currentScore+"_spa.mp3",z.maxNumberVo="assets/audios/number/SS_"+e.maxScore+"_spa.mp3",e.avgPecentage>=70?q.push(z.eol1,z.numberVo,z.eol2,z.maxNumberVo,z.eol3):q.push(z.eol4,z.numberVo,z.eol2,z.maxNumberVo,z.eol3)),console.log("gameAudio.eol1",z.eol1,"gameAudio.eol2",z.eol2,"gameAudio.eol3",z.eol3,"gameAudio.eol4",z.eol4),me()},1e3),e.displayedReportData.percentCorrect=Math.round(e.avgPecentage)+"%",e.fullGameReport=e.displayedReportData,e.$emit(t.SAVE_TINCAN_DATA))},3500)}),e.$on(t.ACTIVITY_LOADED,function(){e.$emit("initAccessibility"),y=o.getConfigData().data.tincan,console.log("--tincanData--",y),null==y.userDetails||void 0==y.userDetails?(e.displayedReportData.userName="ID-5225",console.log("if condition ACTIVITY_LOADED",e.displayedReportData.userName)):(e.displayedReportData.userName=y.userDetails.userId,console.log("else condition ACTIVITY_LOADED",e.displayedReportData.userName)),y.restoreGame?(e.showSplashScreen=y.savedState.splashScreen,v.start(y.savedState.runningTime),e.showDialog=!0,e.openOptionsDialog=!0,e.restoreGameState(),n(function(){AccessibilityManager.setTabGroup("gameDialog"),AccessibilityManager.updateTabOrder("gameDialog",function(){AccessibilityManager.setFocus("#restoreGame")},1e3)})):n(function(){AccessibilityManager.setFocus(_.playButtonBox)},1e3),n(function(){AccessibilityManager.registerActionHandler("cancelDropByAccessibility","","",function(){AccessibilityManager.setTabGroup("pictureTiles"),AccessibilityManager.updateTabOrder("pictureTiles",function(){W(W(_.optionPicture+":visible")[0]).closest(_.activeDraggable).focus()}),AccessibilityManager.disableElements([_.dropZone])}),AccessibilityManager.registerActionHandler("closePopup","","",function(){e.infoInteraction()}),"game_4"==e.displayedReportData.gameName||"game_5"==e.displayedReportData.gameName?AccessibilityManager.enableElements([_.oddRhymeFly,_.chameleonInteraction]):(AccessibilityManager.enableElements([_.activeDraggable]),AccessibilityManager.disableElements([_.oddRhymeFly,_.chameleonInteraction]));W(".row-1").height()},1e3)}),e.$on("saveViewTincanData",function(){if(void 0===e.fullGameReport.percentCorrect)TincanManager.updateTincanData(e.$parent.appData.data.tincan,"total_score",l.getCurrentScore());else{var t=e.fullGameReport.percentCorrect.substring(0,e.fullGameReport.percentCorrect.length-1);TincanManager.updateTincanData(e.$parent.appData.data.tincan,"percentage_completion",t+"%")}TincanManager.updateTincanData(e.$parent.appData.data.tincan,"restoreGame",!0),e.saveGameState()}),e.saveGameState=function(){console.log("saveGameState droppedPictures",M),e.$parent.appData.data.tincan.savedState={gameScore:l.getCurrentScore(),droppedPictures:M,currentQuestionV45:e.currentQuestionV45,runningTime:v.addTimelinePoint(),sortingResponse:e.sortingResponse[0],gameReport:e.fullGameReport,splashScreen:e.showSplashScreen,displayedReportData:e.displayedReportData}},e.restoreGameState=function(){e.showDialog=!1,e.openOptionsDialog=!1,e.fullGameReport=y.savedState.gameReport,e.displayedReportData=y.savedState.displayedReportData;var t=!1;t="game_4"==e.displayedReportData.gameName||"game_5"==e.displayedReportData.gameName,t?le():pe(),AccessibilityManager.setTabGroup("infoButton"),AccessibilityManager.updateTabOrder("infoButton",function(){AccessibilityManager.setFocus(".infoIcon")})},e.showGameReport=function(){e.showDialog=!0,v.addTimelinePoint();var t=v.runningTime().split(":");"00"==t[0]?"00"==t[1]?e.runningTime=t[2]/1+" Seconds":e.runningTime=t[1]/1+" Minutes, "+t[2]/1+" Seconds":e.runningTime=t[0]/1+" Hours, "+t[1]/1+" Minutes, "+t[2]/1+" Seconds",e.engineModeV123?(e.reportItem2="Total words to sort",e.reportItem2Val=I):(e.reportItem2="Total questions attempted",e.reportItem2Val=e.currentQuestionV45),e.openReportDialog=!0},e.getDateString=function(e){var t=e.getDate(),a=e.getMonth()+1,o=e.getFullYear();return t<10&&(t="0"+t),a<10&&(a="0"+a),a+"/"+t+"/"+o},e.getTimeString=function(e){var t=e.getHours(),a=e.getMinutes(),o=t>=12?"pm":"am";return t%=12,t=t||12,a=a<10?"0"+a:a,t+":"+a+" "+o},e.millisToMinutesAndSeconds=function(e){var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(0);return a=a.replace(/^0+/,""),t+" min "+a+" secs"}}]),myView.directive("viewDirective",function(){return{retrict:"E",replace:!0,scope:!0,controller:"viewCtrl",templateUrl:"templates/view.html",link:function(e,t,a){}}});